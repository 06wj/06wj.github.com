(function(){var b=Q.use("billd"),c=b.R={};c.sources=[{id:"billd",size:31,src:"images/billd.gif?1"},{id:"bck",size:58,src:"images/groundBack1.jpg?1"},{id:"hitGround",size:51,src:"images/hitGround.png?1"}];c.init=function(a){this.images=a;this.initResources();this.initHitData()};c.initResources=function(){this.hitGround={image:this.getImage("hitGround"),rect:[0,0,6812,545],x:-3406,eventEnabled:!1};this.bck={image:this.getImage("bck"),rect:[0,0,5782,545],x:-2891,eventEnabled:!1};this.billd={image:this.getImage("billd"),
interval:50,y:333,x:100,regX:60,regY:120,eventEnabled:!1}};c.getImage=function(a){return this.images[a].image};c.initHitData=function(){var a=Q.createDOM("canvas",{width:3406,height:545});a.getContext("2d").drawImage(this.getImage("hitGround"),0,0);for(var a=a.getContext("2d").getImageData(0,0,3406,545).data,c=b.hitY=[],d=0;d<3406;d++)for(var e=0;e<545;e++)if(a[(e*3406+d)*4+3]>0.1){c.push(e);break}}})();(function(){var b=Q.use("billd"),c=b.Billd=function(a){Q.MovieClip.call(this,a);this.id=Q.UIDUtil.createUID("Billd");this.hitX=this.x;this.speedX=5;this.g=0.5;this.speedY=0;this.isJump=!1;this.initFrames()};Quark.inherit(c,Q.MovieClip);c.prototype.initFrames=function(){var a=[],c,b;for(c=0;c<2;c++)for(b=0;b<12;b++)a.push({rect:[b*120,c*120,120,120]});a[0].label=a[5].jump="run";a[6].label=a[11].jump="walk";a[12].label=a[23].jump="jump";this.addFrame(a)};c.prototype.hitGround=function(){this.hitX=parseInt((this.x+
Math.abs(b.hitGround.x)%3406)%3406);return this.y>b.hitY[this.hitX]?!0:!1};c.prototype.move=function(a){this.speedX=7;if(!this.isJump&&this.label!=1)this.label=1,this.gotoAndPlay("run");this.scaleX=a};c.prototype.walk=function(){this.speedX=0.5;if(!this.isJump&&this.label!=2)this.label=2,this.gotoAndPlay("walk")};c.prototype.jump=function(){if(this.label!=3)this.speedY=-14,this.isJump=!0,this.label=3,this.gotoAndPlay("jump");this.y--};c.prototype.update=function(){this.x+=this.scaleX*this.speedX;
this.y+=this.speedY;if(this.x>b.game.width-350)this.x=b.game.width-350,this.moveGround(this.speedX);else if(this.x<350)this.x=350,this.moveGround(-this.speedX);if(this.hitGround()){if(this.isJump||this.speedY>16)this.isJump=!1;for(this.speedY=0;this.hitGround();)this.y--;this.y++}else this.speedY+=this.g};c.prototype.moveGround=function(a){b.bck.x-=a*1.5;b.hitGround.x-=a;if(a<0){if(b.bck.x>=0)b.bck.x=-2891;if(b.hitGround.x>=0)b.hitGround.x=-3406}else if(a>0){if(b.bck.x<=-2891)b.bck.x=0;if(b.hitGround.x<=
-3406)b.hitGround.x=0}}})();(function(){var b=Q.use("billd"),c=b.keyState={};b.initEvent=function(){Q.supportTouch?(b.game.container.ontouchstart=function(a){a.preventDefault();c[Q.KEY.UP]=!0},b.game.container.ontouchend=function(a){a.preventDefault();c[Q.KEY.UP]=!1},window.ondeviceorientation=function(a){var b,d=window.orientation;if(d==90)b=a.beta;else if(d==-90)b=-a.beta;else if(d==0)b=a.gamma;b>5?c[Q.KEY.RIGHT]=!0:b<-5?c[Q.KEY.LEFT]=!0:(c[Q.KEY.RIGHT]=!1,c[Q.KEY.LEFT]=!1)}):(document.onkeydown=function(a){a.preventDefault();
c[a.keyCode]=!0},document.onkeyup=function(a){a.preventDefault();c[a.keyCode]=!1})};b.keyEvent=function(){c[Q.KEY.RIGHT]?b.player.move(1):c[Q.KEY.LEFT]?b.player.move(-1):b.player.walk();c[Q.KEY.UP]&&b.player.hitGround()&&b.player.jump()}})();(function(){function b(){c.game.frames++;c.keyEvent()}window.onload=function(){setTimeout(function(){a.load()},10)};var c=Q.use("billd"),a=c.game={fps:60,frames:0};a.load=function(b){Q.isIpod||Q.isIphone?(this.width=980,this.height=545,Q.addMeta({name:"viewport",content:"user-scalable=no"})):(Q.addMeta({name:"viewport",content:"user-scalable=no, initial-scale=1.0, minimum-scale=1, maximum-scale=1"}),this.width=Math.min(1024,window.innerWidth),this.height=Math.min(768,window.innerHeight));this.container=
b||Q.getDOM("container");this.container.style.overflow="hidden";this.container.style.width=this.width+"px";this.container.style.height=this.height+"px";this.screenWidth=window.innerWidth;this.screenHeight=window.innerHeight;b=Q.createDOM("div",{innerHTML:"\u6b63\u5728\u52a0\u8f7d\u8d44\u6e90\u4e2d\uff0c\u8bf7\u7a0d\u5019...<br>",style:{id:"loader",position:"absolute",width:this.width+"px",left:"0px",top:(this.height>>1)+"px",textAlign:"center",color:"#000",font:Q.isMobile?"bold 16px \u9ed1\u4f53":
"bold 16px \u5b8b\u4f53",textShadow:"0 2px 2px #111"}});this.container.appendChild(b);this.loader=b;this.hideNavBar();if(Q.supportOrientation)window.onorientationchange=function(){a.hideNavBar();a.stage&&a.stage.updatePosition()};b=new Q.ImageLoader;b.addEventListener("loaded",Q.delegate(this.onLoadLoaded,this));b.addEventListener("complete",Q.delegate(this.onLoadComplete,this));b.load(c.R.sources)};a.onLoadLoaded=function(a){this.loader.innerHTML="\u6b63\u5728\u52a0\u8f7d\u8d44\u6e90\u4e2d\uff0c\u8bf7\u7a0d\u5019...<br>("+
Math.round(a.target.getLoadedSize()/a.target.getTotalSize()*100)+"%)"};a.onLoadComplete=function(a){a.target.removeAllEventListeners();this.init(a.images)};a.init=function(a){c.R.init(a);this.startup()};a.startup=function(){this.container.removeChild(this.loader);this.loader=null;if(Q.isWebKit&&!Q.supportTouch)document.body.style.webkitTouchCallout="none",document.body.style.webkitUserSelect="none",document.body.style.webkitTextSizeAdjust="none",document.body.style.webkitTapHighlightColor="rgba(0,0,0,0)";
this.context=new Q.DOMContext({canvas:this.container});this.stage=new Q.Stage({width:980,height:545,context:this.context});var a=this.timer=new Q.Timer(1E3/this.fps);a.addListener(this.stage);a.addListener(Q.Tween);a.start();this.showFPS();var a=this.width/980,b=this.height/545;this.stage.regX=490;this.stage.x=this.width/2;this.stage.scaleX=this.stage.scaleY=Math.min(a,b);this.addObjects()};a.addObjects=function(){c.bck=new Q.Bitmap(c.R.bck);this.stage.addChild(c.bck);c.hitGround=new Q.Bitmap(c.R.hitGround);
this.stage.addChild(c.hitGround);c.player=new c.Billd(c.R.billd);this.stage.addChild(c.player);c.initEvent();this.stage.update=b};a.showFPS=function(){var a=this,b=Quark.getDOM("fps");b&&setInterval(function(){b.innerHTML="FPS:"+a.frames;a.frames=0},1E3)};a.hideNavBar=function(){window.scrollTo(0,1)}})();
